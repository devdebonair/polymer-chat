<link rel="import" type="text/html" href="/elements/message-panel.html">

<dom-module id="chat-room">
	<style>
		.chat-room-wrapper {
			padding: 0px 40px 0px 15px;
		}

		.message-panel-wrapper {
			padding-bottom: 15px;
		}
	</style>
	<template>
		<div class="chat-room-wrapper flex layout">
			<template is="dom-repeat" items="{{messages}}">
				<div class="message-panel-wrapper">
					<message-panel 
						username="{{item.sender}}" 
						message="{{item.content}}" 
						sender="{{isSender(item.sender)}}"
						avatar="{{getAvatar(item.sender)}}">
					</message-panel>
				</div>
			</template>
		</div>
	</template>
</dom-module>

<script type="text/javascript">
	Polymer({
		is: "chat-room",
		ready: function()
		{
			this.activeRoom = document.querySelector('#chat-model').activeRoom;
			if(this.activeRoom && this.activeRoom.messages)
			{
				this.messages = this.activeRoom.messages;
			}
		},
		isSender: function(name)
		{
			var username = document.querySelector('#chat-model').username.toLowerCase();
			name = name.toLowerCase();
			return (username === name);
		},
		getAvatar: function(name)
		{
			return 'http://api.adorable.io/avatars/285/'+name+'.io.png';
		}
	});
</script>